"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _htmlGenerator = _interopRequireDefault(require("./htmlGenerator"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const open = require('open');

let copyfiles = require("copyfiles");

const fs = require('fs-extra');

const path = require('path');

const moment = require('moment');

const logger = require('@log4js-node/log4js-api');

function walk(dir, extensions, filelist = []) {
  const files = fs.readdirSync(dir);
  files.forEach(function (file) {
    const filepath = path.join(dir, file);
    const stat = fs.statSync(filepath);

    if (stat.isDirectory()) {
      filelist = walk(filepath, extensions, filelist);
    } else {
      extensions.forEach(function (extension) {
        if (file.indexOf(extension) == file.length - extension.length) {
          filelist.push(filepath);
        }
      });
    }
  });
  return filelist;
}

class ReportAggregator {
  constructor(opts) {
    opts = Object.assign({}, {
      outputDir: 'reports/html-reports/',
      filename: 'master-report.html',
      reportTitle: 'Test Master Report',
      showInBrowser: false,
      templateFilename: path.resolve(__dirname, '../templates/wdio-html-reporter-template.hbs'),
      templateFuncs: {},
      browserName: "not specified",
      collapseTests: false,
      LOG: null
    }, opts);
    this.options = opts;

    if (!this.options.LOG) {
      this.options.LOG = logger.getLogger("default");
    }

    this.options.reportFile = path.join(process.cwd(), this.options.outputDir, this.options.filename);
    this.reports = [];
  }

  clean() {
    fs.emptyDirSync(this.options.outputDir);
  }

  readJsonFiles() {
    return walk(this.options.outputDir, [".json"]);
  }

  log(message, object) {
    if (this.options.LOG) {
      this.options.LOG.debug(message + object);
    }
  }

  async createReport() {
    if (this.options.LOG) {
      this.options.LOG.debug("Report Aggregation started");
    }

    let metrics = {
      passed: 0,
      skipped: 0,
      failed: 0,
      start: new moment(),
      end: new moment(),
      duration: 0
    };
    let suites = [];
    let specs = [];
    let files = this.readJsonFiles();

    for (let i = 0; i < files.length; i++) {
      try {
        let filename = files[i];
        let report = JSON.parse(fs.readFileSync(filename));

        if (!report.info || !report.info.specs) {
          this.options.LOG.error("report structure in question, no info or info.specs ", JSON.stringify(report));
          this.options.LOG.info("report content: ", JSON.stringify(report));
        }

        report.info.specs.forEach(spec => {
          specs.push(spec);
        });
        this.reports.push(report);
        metrics.passed += report.metrics.passed;
        metrics.failed += report.metrics.failed;
        metrics.skipped += report.metrics.skipped;

        for (let k = 0; k < report.suites.length; k++) {
          let suite = report.suites[k];
          let start = moment.utc(suite.start);

          if (start.isSameOrBefore(metrics.start)) {
            metrics.start = start;
          }

          let end = moment.utc(suite.end);

          if (end.isAfter(metrics.end)) {
            metrics.end = end;
          }

          suites.push(suite);
        }
      } catch (ex) {
        console.error(ex);
      }
    }

    if (!this.reports || !this.reports.length) {
      // the test failed hard at the beginning.  Create a dummy structure to get through html generation
      let report = {
        "info": {
          "cid": "The execution of the test suite has failed before report generation was started.  Please look at the logs to determine the error, this is likely an issue with your configuration files.",
          "config": {
            "hostname": "localhost"
          },
          "specs": [],
          "suites": [{
            "uid": "Test Start Failure",
            "title": "Test Start Failure",
            "type": "suite",
            "tests": []
          }]
        }
      };
      this.reports = [];
      this.reports.push(report);
    }

    let duration = metrics.end.diff(metrics.start);
    metrics.duration = moment.duration(duration, "milliseconds").format('hh:mm:ss.SS', {
      trim: false
    });
    metrics.start = metrics.start.format();
    metrics.end = metrics.end.format();
    const reportOptions = {
      data: {
        info: this.reports[0].info,
        specs: specs,
        metrics: metrics,
        suites: suites,
        title: this.options.reportTitle,
        browserName: this.options.browserName
      },
      outputDir: this.options.outputDir,
      reportFile: this.options.reportFile,
      templateFilename: this.options.templateFilename,
      LOG: this.options.LOG,
      templateFuncs: this.options.templateFuncs,
      showInBrowser: this.options.showInBrowser,
      collapseTests: this.options.collapseTests
    };

    if (this.options.LOG) {
      this.options.LOG.debug("Aggregated " + specs.length + " specs, " + suites.length + " suites, " + this.reports.length + " reports, ");
    }

    _htmlGenerator.default.htmlOutput(reportOptions);

    reportOptions.LOG.debug("Report Aggregation completed");
    let jsFiles = path.join(__dirname, '../js/*.*');
    let reportDir = path.join(process.cwd(), this.options.outputDir);
    copyfiles([jsFiles, reportDir], true, () => {
      reportOptions.LOG.info('copyfiles complete : ' + jsFiles + " to " + reportDir);

      try {
        if (this.options.showInBrowser) {
          let childProcess = open(this.options.reportFile);
          childProcess.then(() => {
            reportOptions.LOG.info('browser launched');
          }, error => {
            reportOptions.LOG.error('showInBrowser error spawning :' + this.options.reportFile + " " + error.toString());
          });
        }
      } catch (ex) {
        reportOptions.LOG.error('Error opening browser:' + ex);
      }
    });
  }

}

var _default = ReportAggregator;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRBZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm9wZW4iLCJyZXF1aXJlIiwiY29weWZpbGVzIiwiZnMiLCJwYXRoIiwibW9tZW50IiwibG9nZ2VyIiwid2FsayIsImRpciIsImV4dGVuc2lvbnMiLCJmaWxlbGlzdCIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZSIsImZpbGVwYXRoIiwiam9pbiIsInN0YXQiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0ZW5zaW9uIiwiaW5kZXhPZiIsImxlbmd0aCIsInB1c2giLCJSZXBvcnRBZ2dyZWdhdG9yIiwiY29uc3RydWN0b3IiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwib3V0cHV0RGlyIiwiZmlsZW5hbWUiLCJyZXBvcnRUaXRsZSIsInNob3dJbkJyb3dzZXIiLCJ0ZW1wbGF0ZUZpbGVuYW1lIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInRlbXBsYXRlRnVuY3MiLCJicm93c2VyTmFtZSIsImNvbGxhcHNlVGVzdHMiLCJMT0ciLCJvcHRpb25zIiwiZ2V0TG9nZ2VyIiwicmVwb3J0RmlsZSIsInByb2Nlc3MiLCJjd2QiLCJyZXBvcnRzIiwiY2xlYW4iLCJlbXB0eURpclN5bmMiLCJyZWFkSnNvbkZpbGVzIiwibG9nIiwibWVzc2FnZSIsIm9iamVjdCIsImRlYnVnIiwiY3JlYXRlUmVwb3J0IiwibWV0cmljcyIsInBhc3NlZCIsInNraXBwZWQiLCJmYWlsZWQiLCJzdGFydCIsImVuZCIsImR1cmF0aW9uIiwic3VpdGVzIiwic3BlY3MiLCJpIiwicmVwb3J0IiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwiaW5mbyIsImVycm9yIiwic3RyaW5naWZ5Iiwic3BlYyIsImsiLCJzdWl0ZSIsInV0YyIsImlzU2FtZU9yQmVmb3JlIiwiaXNBZnRlciIsImV4IiwiY29uc29sZSIsImRpZmYiLCJmb3JtYXQiLCJ0cmltIiwicmVwb3J0T3B0aW9ucyIsImRhdGEiLCJ0aXRsZSIsIkh0bWxHZW5lcmF0b3IiLCJodG1sT3V0cHV0IiwianNGaWxlcyIsInJlcG9ydERpciIsImNoaWxkUHJvY2VzcyIsInRoZW4iLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBRUEsTUFBTUUsRUFBRSxHQUFHRixPQUFPLENBQUMsVUFBRCxDQUFsQjs7QUFDQSxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1JLE1BQU0sR0FBR0osT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUssTUFBTSxHQUFHTCxPQUFPLENBQUMseUJBQUQsQ0FBdEI7O0FBRUEsU0FBVU0sSUFBVixDQUFlQyxHQUFmLEVBQW9CQyxVQUFwQixFQUFpQ0MsUUFBUSxHQUFHLEVBQTVDLEVBQWdEO0FBQzVDLFFBQU1DLEtBQUssR0FBR1IsRUFBRSxDQUFDUyxXQUFILENBQWVKLEdBQWYsQ0FBZDtBQUVBRyxFQUFBQSxLQUFLLENBQUNFLE9BQU4sQ0FBYyxVQUFVQyxJQUFWLEVBQWdCO0FBQzFCLFVBQU1DLFFBQVEsR0FBR1gsSUFBSSxDQUFDWSxJQUFMLENBQVVSLEdBQVYsRUFBZU0sSUFBZixDQUFqQjtBQUNBLFVBQU1HLElBQUksR0FBR2QsRUFBRSxDQUFDZSxRQUFILENBQVlILFFBQVosQ0FBYjs7QUFFQSxRQUFJRSxJQUFJLENBQUNFLFdBQUwsRUFBSixFQUF3QjtBQUNwQlQsTUFBQUEsUUFBUSxHQUFHSCxJQUFJLENBQUNRLFFBQUQsRUFBV04sVUFBWCxFQUF1QkMsUUFBdkIsQ0FBZjtBQUNILEtBRkQsTUFFTztBQUNIRCxNQUFBQSxVQUFVLENBQUNJLE9BQVgsQ0FBbUIsVUFBVU8sU0FBVixFQUFxQjtBQUNwQyxZQUFJTixJQUFJLENBQUNPLE9BQUwsQ0FBYUQsU0FBYixLQUEy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YUFBYSxDQUFDM0MsR0FBZCxDQUFrQjhCLEtBQWxCLENBQXdCLG1DQUFtQyxLQUFLN0IsT0FBTCxDQUFhRSxVQUFoRCxHQUE2RCxHQUE3RCxHQUFtRTJCLEtBQUssQ0FBQ3NCLFFBQU4sRUFBM0Y7QUFDSCxXQU5MO0FBT0g7QUFDSixPQVpELENBWUUsT0FBT2QsRUFBUCxFQUFXO0FBQ1RLLFFBQUFBLGFBQWEsQ0FBQzNDLEdBQWQsQ0FBa0I4QixLQUFsQixDQUF3QiwyQkFBMkJRLEVBQW5EO0FBQ0g7QUFDSixLQWxCSSxDQUFUO0FBcUJIOztBQXBLa0I7O2VBeUtSckQsZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSHRtbEdlbmVyYXRvciBmcm9tIFwiLi9odG1sR2VuZXJhdG9yXCI7XHJcbmNvbnN0IG9wZW4gPSByZXF1aXJlKCdvcGVuJyk7XHJcbmxldCBjb3B5ZmlsZXMgPSByZXF1aXJlKFwiY29weWZpbGVzXCIpO1xyXG5cclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnQGxvZzRqcy1ub2RlL2xvZzRqcy1hcGknKTtcclxuXHJcbmZ1bmN0aW9uICB3YWxrKGRpciwgZXh0ZW5zaW9ucyAsIGZpbGVsaXN0ID0gW10pIHtcclxuICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcclxuXHJcbiAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7XHJcbiAgICAgICAgY29uc3QgZmlsZXBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlKTtcclxuICAgICAgICBjb25zdCBzdGF0ID0gZnMuc3RhdFN5bmMoZmlsZXBhdGgpO1xyXG5cclxuICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XHJcbiAgICAgICAgICAgIGZpbGVsaXN0ID0gd2FsayhmaWxlcGF0aCwgZXh0ZW5zaW9ucywgZmlsZWxpc3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGV4dGVuc2lvbnMuZm9yRWFjaChmdW5jdGlvbiAoZXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZS5pbmRleE9mKGV4dGVuc2lvbikgPT0gZmlsZS5sZW5ndGggLSBleHRlbnNpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZWxpc3QucHVzaChmaWxlcGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmaWxlbGlzdDtcclxufVxyXG5cclxuY2xhc3MgUmVwb3J0QWdncmVnYXRvciB7XHJcblxyXG4gICAgY29uc3RydWN0b3Iob3B0cykge1xyXG4gICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB7XHJcbiAgICAgICAgICAgIG91dHB1dERpcjogJ3JlcG9ydHMvaHRtbC1yZXBvcnRzLycsXHJcbiAgICAgICAgICAgIGZpbGVuYW1lOiAnbWFzdGVyLXJlcG9ydC5odG1sJyxcclxuICAgICAgICAgICAgcmVwb3J0VGl0bGU6ICdUZXN0IE1hc3RlciBSZXBvcnQnLFxyXG4gICAgICAgICAgICBzaG93SW5Ccm93c2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVGaWxlbmFtZTogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uL3RlbXBsYXRlcy93ZGlvLWh0bWwtcmVwb3J0ZXItdGVtcGxhdGUuaGJzJyksXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRnVuY3M6IHt9LFxyXG4gICAgICAgICAgICBicm93c2VyTmFtZTogXCJub3Qgc3BlY2lmaWVkXCIsXHJcbiAgICAgICAgICAgIGNvbGxhcHNlVGVzdHM6IGZhbHNlLFxyXG4gICAgICAgICAgICBMT0c6IG51bGxcclxuICAgICAgICB9LCBvcHRzKTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRzO1xyXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HID0gbG9nZ2VyLmdldExvZ2dlcihcImRlZmF1bHRcIikgICAgICA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMub3B0aW9ucy5vdXRwdXREaXIsIHRoaXMub3B0aW9ucy5maWxlbmFtZSk7XHJcbiAgICAgICAgdGhpcy5yZXBvcnRzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYW4oKSB7XHJcbiAgICAgICAgZnMuZW1wdHlEaXJTeW5jKHRoaXMub3B0aW9ucy5vdXRwdXREaXIpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgcmVhZEpzb25GaWxlcygpIHtcclxuICAgICAgICByZXR1cm4gd2Fsayh0aGlzLm9wdGlvbnMub3V0cHV0RGlyLCBbXCIuanNvblwiXSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGxvZyhtZXNzYWdlLG9iamVjdCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZGVidWcobWVzc2FnZSArIG9iamVjdCkgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIGNyZWF0ZVJlcG9ydCgpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmRlYnVnKFwiUmVwb3J0IEFnZ3JlZ2F0aW9uIHN0YXJ0ZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBtZXRyaWNzID0ge1xyXG4gICAgICAgICAgICBwYXNzZWQ6IDAsXHJcbiAgICAgICAgICAgIHNraXBwZWQ6IDAsXHJcbiAgICAgICAgICAgIGZhaWxlZDogMCxcclxuICAgICAgICAgICAgc3RhcnQgOiBuZXcgbW9tZW50KCksXHJcbiAgICAgICAgICAgIGVuZCA6IG5ldyBtb21lbnQoKSxcclxuICAgICAgICAgICAgZHVyYXRpb246IDBcclxuICAgICAgICB9O1xyXG4gICAgICAgIGxldCBzdWl0ZXMgPSBbXTtcclxuICAgICAgICBsZXQgc3BlY3MgPSBbXTtcclxuXHJcbiAgICAgICAgbGV0IGZpbGVzID0gdGhpcy5yZWFkSnNvbkZpbGVzKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGxldCBmaWxlbmFtZSA9IGZpbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlcG9ydCA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGZpbGVuYW1lKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcG9ydC5pbmZvIHx8ICFyZXBvcnQuaW5mby5zcGVjcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZXJyb3IoXCJyZXBvcnQgc3RydWN0dXJlIGluIHF1ZXN0aW9uLCBubyBpbmZvIG9yIGluZm8uc3BlY3MgXCIgLCBKU09OLnN0cmluZ2lmeShyZXBvcnQpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmluZm8oXCJyZXBvcnQgY29udGVudDogXCIgLCBKU09OLnN0cmluZ2lmeShyZXBvcnQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlcG9ydC5pbmZvLnNwZWNzLmZvckVhY2goKHNwZWMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzcGVjcy5wdXNoKHNwZWMpIDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydHMucHVzaChyZXBvcnQpO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5wYXNzZWQgKz0gcmVwb3J0Lm1ldHJpY3MucGFzc2VkO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5mYWlsZWQgKz0gcmVwb3J0Lm1ldHJpY3MuZmFpbGVkO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5za2lwcGVkICs9IHJlcG9ydC5tZXRyaWNzLnNraXBwZWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCByZXBvcnQuc3VpdGVzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1aXRlID0gcmVwb3J0LnN1aXRlc1trXSA7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gbW9tZW50LnV0YyhzdWl0ZS5zdGFydCkgO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhcnQuaXNTYW1lT3JCZWZvcmUobWV0cmljcy5zdGFydCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5zdGFydCA9ICBzdGFydCA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbmQgPSBtb21lbnQudXRjKHN1aXRlLmVuZCkgO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZW5kLmlzQWZ0ZXIobWV0cmljcy5lbmQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY3MuZW5kID0gIGVuZCA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN1aXRlcy5wdXNoKHN1aXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMucmVwb3J0cyB8fCAhdGhpcy5yZXBvcnRzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgLy8gdGhlIHRlc3QgZmFpbGVkIGhhcmQgYXQgdGhlIGJlZ2lubmluZy4gIENyZWF0ZSBhIGR1bW15IHN0cnVjdHVyZSB0byBnZXQgdGhyb3VnaCBodG1sIGdlbmVyYXRpb25cclxuICAgICAgICAgICAgbGV0IHJlcG9ydCA9IHtcclxuICAgICAgICAgICAgICAgIFwiaW5mb1wiIDoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiY2lkXCI6IFwiVGhlIGV4ZWN1dGlvbiBvZiB0aGUgdGVzdCBzdWl0ZSBoYXMgZmFpbGVkIGJlZm9yZSByZXBvcnQgZ2VuZXJhdGlvbiB3YXMgc3RhcnRlZC4gIFBsZWFzZSBsb29rIGF0IHRoZSBsb2dzIHRvIGRldGVybWluZSB0aGUgZXJyb3IsIHRoaXMgaXMgbGlrZWx5IGFuIGlzc3VlIHdpdGggeW91ciBjb25maWd1cmF0aW9uIGZpbGVzLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiY29uZmlnXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJob3N0bmFtZVwiOiBcImxvY2FsaG9zdFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwic3BlY3NcIjogW10sXHJcbiAgICAgICAgICAgICAgICBcInN1aXRlc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVpZFwiOiBcIlRlc3QgU3RhcnQgRmFpbHVyZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiVGVzdCBTdGFydCBGYWlsdXJlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInN1aXRlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVzdHNcIjogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5yZXBvcnRzID0gW10gO1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9ydHMucHVzaChyZXBvcnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGR1cmF0aW9uID0gbWV0cmljcy5lbmQuZGlmZihtZXRyaWNzLnN0YXJ0KSA7XHJcbiAgICAgICAgbWV0cmljcy5kdXJhdGlvbiA9IG1vbWVudC5kdXJhdGlvbihkdXJhdGlvbiwgXCJtaWxsaXNlY29uZHNcIikuZm9ybWF0KCdoaDptbTpzcy5TUycsIHt0cmltOiBmYWxzZX0pO1xyXG4gICAgICAgIG1ldHJpY3Muc3RhcnQgPSBtZXRyaWNzLnN0YXJ0LmZvcm1hdCgpIDtcclxuICAgICAgICBtZXRyaWNzLmVuZCA9IG1ldHJpY3MuZW5kLmZvcm1hdCgpIDtcclxuXHJcbiAgICAgICAgY29uc3QgcmVwb3J0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgaW5mbzogdGhpcy5yZXBvcnRzWzBdLmluZm8sXHJcbiAgICAgICAgICAgICAgICBzcGVjczpzcGVjcyxcclxuICAgICAgICAgICAgICAgIG1ldHJpY3M6IG1ldHJpY3MsXHJcbiAgICAgICAgICAgICAgICBzdWl0ZXM6IHN1aXRlcyxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMucmVwb3J0VGl0bGUsXHJcbiAgICAgICAgICAgICAgICBicm93c2VyTmFtZTogdGhpcy5vcHRpb25zLmJyb3dzZXJOYW1lXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG91dHB1dERpcjogdGhpcy5vcHRpb25zLm91dHB1dERpcixcclxuICAgICAgICAgICAgcmVwb3J0RmlsZTogdGhpcy5vcHRpb25zLnJlcG9ydEZpbGUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZW5hbWU6IHRoaXMub3B0aW9ucy50ZW1wbGF0ZUZpbGVuYW1lLFxyXG4gICAgICAgICAgICBMT0cgOiB0aGlzLm9wdGlvbnMuTE9HLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZ1bmNzOiB0aGlzLm9wdGlvbnMudGVtcGxhdGVGdW5jcyxcclxuICAgICAgICAgICAgc2hvd0luQnJvd3NlcjogdGhpcy5vcHRpb25zLnNob3dJbkJyb3dzZXIsXHJcbiAgICAgICAgICAgIGNvbGxhcHNlVGVzdHM6IHRoaXMub3B0aW9ucy5jb2xsYXBzZVRlc3RzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5kZWJ1ZyhcIkFnZ3JlZ2F0ZWQgXCIgKyBzcGVjcy5sZW5ndGggKyBcIiBzcGVjcywgXCIgKyBzdWl0ZXMubGVuZ3RoICsgXCIgc3VpdGVzLCBcIiArIHRoaXMucmVwb3J0cy5sZW5ndGggKyBcIiByZXBvcnRzLCBcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEh0bWxHZW5lcmF0b3IuaHRtbE91dHB1dChyZXBvcnRPcHRpb25zKTtcclxuICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5kZWJ1ZyhcIlJlcG9ydCBBZ2dyZWdhdGlvbiBjb21wbGV0ZWRcIik7XHJcbiAgICAgICAgbGV0IGpzRmlsZXMgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vanMvKi4qJyk7XHJcbiAgICAgICAgbGV0IHJlcG9ydERpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLm9wdGlvbnMub3V0cHV0RGlyKTtcclxuICAgICAgICBjb3B5ZmlsZXMoIFtqc0ZpbGVzLCByZXBvcnREaXJdICwgdHJ1ZSxcclxuICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuaW5mbyggJ2NvcHlmaWxlcyBjb21wbGV0ZSA6ICcgKyBqc0ZpbGVzICArIFwiIHRvIFwiICsgcmVwb3J0RGlyKSA7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hvd0luQnJvd3Nlcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoaWxkUHJvY2VzcyA9IG9wZW4odGhpcy5vcHRpb25zLnJlcG9ydEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3MudGhlbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5pbmZvKCdicm93c2VyIGxhdW5jaGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZXJyb3IoJ3Nob3dJbkJyb3dzZXIgZXJyb3Igc3Bhd25pbmcgOicgKyB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSArIFwiIFwiICsgZXJyb3IudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZXJyb3IoJ0Vycm9yIG9wZW5pbmcgYnJvd3NlcjonICsgZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG5cclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZXBvcnRBZ2dyZWdhdG9yO1xyXG4iXX0=